{% load invitation_tags %}

<tr {% if is_oob %}hx-swap-oob="true"{% endif %} id="row-{{ invitation.pk }}" class="hover:bg-lemonade-100 text-lemonade-900">
    <td class="font-medium">{{ invitation.email }}</td>

    <td>{{ invitation.invited_by.user.username|default:"N/A" }}</td>

    <td>
      <div 
        x-data="{ copied: false }" 
        class="flex items-center gap-2 overflow-x-auto max-w-[220px] text-xs text-lemonade-700 px-2 py-1 rounded bg-lemonade-100 whitespace-nowrap"
      >
        <span 
          id="invitation-url-{{ invitation.pk }}" 
          class="truncate block max-w-[160px] select-all"
        >
          {% invitation_url invitation %}
        </span>
        <button 
          type="button" 
          class="p-1 rounded hover:bg-lemonade-200 focus:outline-none"
          title="Copy to clipboard"
          @click="
            navigator.clipboard.writeText($refs.url.innerText)
              .then(() => { copied = true; setTimeout(() => copied = false, 1500); })
          "
        >
          <!-- Clipboard SVG icon -->
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-lemonade-700" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <rect x="9" y="9" width="13" height="13" rx="2" stroke="currentColor" stroke-width="2" fill="none"/>
            <rect x="3" y="3" width="13" height="13" rx="2" stroke="currentColor" stroke-width="2" fill="none"/>
          </svg>
        </button>
        <span 
          x-ref="url" 
          class="hidden"
        >{% invitation_url invitation %}</span>
        <span 
          x-show="copied" 
          x-transition 
          class="ml-1 text-green-600 font-semibold"
          style="display: none;"
        >Copied!</span>
      </div>
    </td>

    <td>
      <span class="badge 
        {% if invitation.is_valid %}
          badge-success
        {% else %}
          badge-error
        {% endif %}
      ">
        {{ invitation.is_valid|yesno:"Valid,Invalid" }}
      </span>
    </td>

    <td>
      {{ invitation.expired_at|date:"Y-m-d H:i" }}
    </td>

    <td class="text-center">
     <a hx-get="{% url 'cancel_invitation' invitation.invitation_id %}" hx-target="#modal-placeholder" hx-swap="innerHTML" class="btn btn-error btn-sm">Cancel Invitation</a>
    </td>
  </tr>